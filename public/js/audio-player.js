const songsData = [
  {
    title: "–õ—é–±–∏–º–æ–º—É",
    name: "–í–∏–∫—Ç–æ—Ä–∏—è",
    audio: "./public/audio/music-1.mp3",
    image: "./public/images/examples/cover.png",
    date: "12 –Ω–æ—è–±—Ä—è 2025",
    color: "#EF0105",
    text: "–ú—É–∂ –î–∏–º–∞. –ó–æ–≤—É –µ–≥–æ ‚Äú–ü—É—Å—è‚ÄùüòÅ –ú—ã –≤–º–µ—Å—Ç–µ 4 –≥–æ–¥–∞. –ö–∞–∫ –≤—Å–µ –Ω–∞—á–∞–ª–æ—Å—å: –¢–≤–æ–µ –Ω–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫—É—Ä–∏—à—å –∫–∞–ª—å—è–Ω –∏ –≤–æ—Ç —É–∂–µ —Ç—ã –≤—ã–∑–≤–∞–ª –º–Ω–µ —Ç–∞–∫—Å–∏, –Ω–µ –∑–Ω–∞—è –¥–∞–∂–µ –∏–º–µ–Ω –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –ø–æ—Ç–æ–º —Ç–µ–ª–µ–ø—Ä–æ–µ–∫—Ç, —Å—Å–æ—Ä—ã, —Ä—É–≥–∞–Ω—å, —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏—è, –Ω–æ –º—ã —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å  –ú—ã –ø–µ—Ä–µ–µ–∑–∂–∞–µ–º –≤ –Ω–∞—à—É –Ω–æ–≤—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É —Ä—è–¥–æ–º —Å –ú–æ—Å–∫–≤–æ–π —Å–∏—Ç–∏ –Ø —Å—á–∞—Å—Ç–ª–∏–≤–∞ , —á—Ç–æ –º—ã –ø—Ä–æ—Ö–æ–¥–∏–º —ç—Ç–æ—Ç –ø—É—Ç—å –≤–º–µ—Å—Ç–µ  –ò –º–Ω–æ–≥–æ–µ –µ—â–µ –≤–ø–µ—Ä–µ–¥–∏",
    duration: 0,
  },
  {
    title: "–ü–µ—Å–Ω—è –∂–µ–Ω–µ",
    name: "–ê–Ω–¥—Ä–µ–π",
    audio: "./public/audio/music-2.mp3",
    image: "./public/images/examples/ex.png",
    date: "15 –Ω–æ—è–±—Ä—è 2025",
    color: "#FF0C59",
    text: "–ú–æ—è –∂–µ–Ω–∞ - —ç—Ç–æ —Å–∞–º—ã–π —Ä–æ–¥–Ω–æ–π –∏ –±–ª–∏–∑–∫–∏–π —á–µ–ª–æ–≤–µ–∫ –¥–ª—è –º–µ–Ω—è. –ú—ã –≤–º–µ—Å—Ç–µ —É–∂–µ –º–Ω–æ–≥–æ –ª–µ—Ç, –∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å –Ω–µ–π - —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å—á–∞—Å—Ç—å–µ. –û–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ–Ω—è –≤ —Ç—Ä—É–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏ —Ä–∞–¥—É–µ—Ç—Å—è —Å–æ –º–Ω–æ–π –≤ –º–æ–º–µ–Ω—Ç—ã —Ä–∞–¥–æ—Å—Ç–∏. –Ø –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é —Å–≤–æ—é –∂–∏–∑–Ω—å –±–µ–∑ –Ω–µ–µ. –≠—Ç–∞ –ø–µ—Å–Ω—è - –º–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤ –ª—é–±–≤–∏ –∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤—Å–µ, —á—Ç–æ –æ–Ω–∞ –¥–ª—è –º–µ–Ω—è –¥–µ–ª–∞–µ—Ç.",
    duration: 0,
  },
  {
    title: "–ü–µ—Å–Ω—è –∂–µ–Ω–µ",
    name: "–ê–Ω–¥—Ä–µ–π",
    audio: "./public/audio/music-2.mp3",
    image: "./public/images/examples/ex.png",
    date: "15 –Ω–æ—è–±—Ä—è 2025",
    color: "#FF4400",
    text: "–ú–æ—è –∂–µ–Ω–∞ - —ç—Ç–æ —Å–∞–º—ã–π —Ä–æ–¥–Ω–æ–π –∏ –±–ª–∏–∑–∫–∏–π —á–µ–ª–æ–≤–µ–∫ –¥–ª—è –º–µ–Ω—è. –ú—ã –≤–º–µ—Å—Ç–µ —É–∂–µ –º–Ω–æ–≥–æ –ª–µ—Ç, –∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å –Ω–µ–π - —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å—á–∞—Å—Ç—å–µ. –û–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ–Ω—è –≤ —Ç—Ä—É–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏ —Ä–∞–¥—É–µ—Ç—Å—è —Å–æ –º–Ω–æ–π –≤ –º–æ–º–µ–Ω—Ç—ã —Ä–∞–¥–æ—Å—Ç–∏. –Ø –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é —Å–≤–æ—é –∂–∏–∑–Ω—å –±–µ–∑ –Ω–µ–µ. –≠—Ç–∞ –ø–µ—Å–Ω—è - –º–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤ –ª—é–±–≤–∏ –∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤—Å–µ, —á—Ç–æ –æ–Ω–∞ –¥–ª—è –º–µ–Ω—è –¥–µ–ª–∞–µ—Ç.",
    duration: 0,
  },
  {
    title: "–ü–µ—Å–Ω—è –∂–µ–Ω–µ",
    name: "–ê–Ω–¥—Ä–µ–π",
    audio: "./public/audio/music-2.mp3",
    image: "./public/images/examples/ex.png",
    date: "15 –Ω–æ—è–±—Ä—è 2025",
    color: "#4971FC",
    text: "–ú–æ—è –∂–µ–Ω–∞ - —ç—Ç–æ —Å–∞–º—ã–π —Ä–æ–¥–Ω–æ–π –∏ –±–ª–∏–∑–∫–∏–π —á–µ–ª–æ–≤–µ–∫ –¥–ª—è –º–µ–Ω—è. –ú—ã –≤–º–µ—Å—Ç–µ —É–∂–µ –º–Ω–æ–≥–æ –ª–µ—Ç, –∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å –Ω–µ–π - —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å—á–∞—Å—Ç—å–µ. –û–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ–Ω—è –≤ —Ç—Ä—É–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏ —Ä–∞–¥—É–µ—Ç—Å—è —Å–æ –º–Ω–æ–π –≤ –º–æ–º–µ–Ω—Ç—ã —Ä–∞–¥–æ—Å—Ç–∏. –Ø –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é —Å–≤–æ—é –∂–∏–∑–Ω—å –±–µ–∑ –Ω–µ–µ. –≠—Ç–∞ –ø–µ—Å–Ω—è - –º–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤ –ª—é–±–≤–∏ –∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤—Å–µ, —á—Ç–æ –æ–Ω–∞ –¥–ª—è –º–µ–Ω—è –¥–µ–ª–∞–µ—Ç.",
    duration: 0,
  },
  {
    title: "–ü–µ—Å–Ω—è –∂–µ–Ω–µ",
    name: "–ê–Ω–¥—Ä–µ–π",
    audio: "./public/audio/music-2.mp3",
    image: "./public/images/examples/ex.png",
    date: "15 –Ω–æ—è–±—Ä—è 2025",
    color: "#88b58b",
    text: "–ú–æ—è –∂–µ–Ω–∞ - —ç—Ç–æ —Å–∞–º—ã–π —Ä–æ–¥–Ω–æ–π –∏ –±–ª–∏–∑–∫–∏–π —á–µ–ª–æ–≤–µ–∫ –¥–ª—è –º–µ–Ω—è. –ú—ã –≤–º–µ—Å—Ç–µ —É–∂–µ –º–Ω–æ–≥–æ –ª–µ—Ç, –∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å –Ω–µ–π - —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ —Å—á–∞—Å—Ç—å–µ. –û–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ–Ω—è –≤ —Ç—Ä—É–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏ —Ä–∞–¥—É–µ—Ç—Å—è —Å–æ –º–Ω–æ–π –≤ –º–æ–º–µ–Ω—Ç—ã —Ä–∞–¥–æ—Å—Ç–∏. –Ø –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é —Å–≤–æ—é –∂–∏–∑–Ω—å –±–µ–∑ –Ω–µ–µ. –≠—Ç–∞ –ø–µ—Å–Ω—è - –º–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –≤ –ª—é–±–≤–∏ –∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤—Å–µ, —á—Ç–æ –æ–Ω–∞ –¥–ª—è –º–µ–Ω—è –¥–µ–ª–∞–µ—Ç.",
    duration: 0,
  },
];

class AudioPlayer {
  constructor(containerSelector) {
    this.container = document.querySelector(containerSelector);
    if (!this.container) {
      console.error(`Container with selector ${containerSelector} not found`);
      return;
    }
    console.log("by @ProKsiKzzz");
    this.currentIndex = 0;
    this.isPlaying = false;
    this.audio = new Audio();
    this.isFullTextVisible = false;
    this.fullText = "";

    this.init();
  }

  init() {
    this.createPlayer();
    this.loadSong(this.currentIndex, false);
    this.bindEvents();
    this.loadAllDurations();

    window.addEventListener("resize", () => this.handleResize());
  }

  createPlayer() {
    this.container.innerHTML = `
      <div class="examples__head">
        <h2 class="examples__head-title">–ü—Ä–∏–º–µ—Ä—ã –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø–µ—Å–µ–Ω</h2>
        <p class="examples__head-text">–£–∂–µ –±–æ–ª–µ–µ 1700 –∏—Å—Ç–æ—Ä–∏–π –ª—é–±–≤–∏, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –∏ –¥—Ä—É–∂–±—ã –º—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∏ –≤ –ø–µ—Å–Ω–∏</p>
      </div>

      <div class="examples__body">
        <div class="examples__body-decorate" style="background: ${songsData[0].color};"></div>
        <div class="examples__player">
          <div class="examples__player-head">
            <div class="examples__player-preview">
              <img width="134" height="134" class="examples__player-preview-img" src="" alt="–ö–∞—Ä—Ç–∏–Ω–∫–∞">
            </div>
            <div class="examples__player-info">
              <div class="examples__player-title"></div>
              <div class="examples__player-name"></div>
            </div>
          </div>
          <div class="examples__player-timer">
            <div class="examples__player-timer-bar">
              <button class="examples__player-prev" type="button">
                <img src="./public/images/examples/icons/prev.svg" alt="–ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–µ—Å–Ω—è">
              </button>
              <div class="examples__player-timer-progress">
                <span class="examples__player-timer-progress-line" style="width: 0%;"></span>
              </div>
              <button class="examples__player-next" type="button">
                <img src="./public/images/examples/icons/next.svg" alt="–°–ª–µ–¥—É—é—â–∞—è –ø–µ—Å–Ω—è">
              </button>
            </div>
            <button class="examples__player-timer-button" type="button">
              <img class="examples__player-timer-button-icon _show" src="./public/images/icons/play.svg"
                   alt="–í–∫–ª—é—á–∏—Ç—å –ø–µ—Å–Ω—é">
              <img class="examples__player-timer-button-icon" src="./public/images/icons/pause.svg"
                   alt="–ü–∞—É–∑–∞">
            </button>
          </div>

          <div class="examples__player-sub-title">–î—Ä—É–≥–∏–µ –ø—Ä–∏–º–µ—Ä—ã</div>

          <div class="examples__player-composition-list-wrapper">
            <ul class="examples__player-composition-list"></ul>
          </div>
          <a class="examples__player-button button button_gradient" href="#">
              <img src="./public/images/icons/mic.svg" alt="–ú–∏–∫—Ä–æ—Ñ–æ–Ω">
              –ó–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é
          </a>
        </div>
        <div class="examples__content">
          <h3 class="examples__content-title"></h3>
          <div class="examples__content-inner">
            <div class="examples__content-picture">
              <img width="385" height="452" class="examples__content-img" src="" alt="–ö–∞—Ä—Ç–∏–Ω–∫–∞">
            </div>
            <div class="examples__content-body">
              <p class="examples__content-text"></p>

              <button class="examples__content-more _show" type="button">
                –ß–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª–Ω–æ—Å—Ç—å—é
              </button>

              <div class="examples__content-date"></div>
            </div>
          </div>
        </div>
      </div>
    `;

    this.playerPreviewImg = this.container.querySelector(
      ".examples__player-preview-img"
    );
    this.playerTitle = this.container.querySelector(".examples__player-title");
    this.playerName = this.container.querySelector(".examples__player-name");
    this.progressBar = this.container.querySelector(
      ".examples__player-timer-progress-line"
    );
    this.timerButton = this.container.querySelector(
      ".examples__player-timer-button"
    );
    const timerIcons = this.container.querySelectorAll(
      ".examples__player-timer-button-icon"
    );
    this.timerPlayIcon = timerIcons[0];
    this.timerPauseIcon = timerIcons[1];

    this.prevButton = this.container.querySelector(".examples__player-prev");
    this.nextButton = this.container.querySelector(".examples__player-next");
    this.compositionList = this.container.querySelector(
      ".examples__player-composition-list"
    );
    this.contentTitle = this.container.querySelector(
      ".examples__content-title"
    );
    this.contentImg = this.container.querySelector(".examples__content-img");
    this.contentText = this.container.querySelector(".examples__content-text");
    this.contentMoreButton = this.container.querySelector(
      ".examples__content-more"
    );
    this.contentDate = this.container.querySelector(".examples__content-date");

    this.renderCompositionList();
  }

  renderCompositionList() {
    this.compositionList.innerHTML = "";
    songsData.forEach((song, index) => {
      const item = document.createElement("li");
      item.className = "examples__player-composition-item";
      item.innerHTML = `
        <button class="examples__player-composition-inner" data-index="${index}">
          <div class="examples__player-composition-cover">
            <img width="53" height="53" class="examples__player-composition-cover-img" src="${song.image}" alt="–ö–∞—Ä—Ç–∏–Ω–∫–∞">
            <div class="examples__player-composition-cover-button">
              <img class="examples__player-composition-cover-button-icon _show" src="./public/images/icons/play.svg" alt="–í–∫–ª—é—á–∏—Ç—å –ø–µ—Å–Ω—é">
              <img class="examples__player-composition-cover-button-icon" src="./public/images/icons/pause.svg" alt="–ü–∞—É–∑–∞">
            </div>
          </div>
          <div class="examples__player-composition-content">
            <div class="examples__player-composition-title">${song.title}</div>
            <div class="examples__player-composition-name">${song.name}</div>
          </div>
          <div class="examples__player-composition-time" data-index="${index}">--:--</div>
        </button>
      `;
      this.compositionList.appendChild(item);
    });

    this.bindCompositionButtons();
    this.updateActiveComposition();
  }

  bindCompositionButtons() {
    const coverButtons = this.container.querySelectorAll(
      ".examples__player-composition-inner"
    );
    coverButtons.forEach((button) => {
      button.addEventListener("click", (e) => {
        const index = parseInt(e.currentTarget.getAttribute("data-index"), 10);

        if (this.currentIndex !== index) {
          this.currentIndex = index;
          this.loadSong(index, true);
          return;
        }

        this.togglePlay();
      });
    });
  }

  updateActiveComposition() {
    const allCompositions = this.container.querySelectorAll(
      ".examples__player-composition-inner"
    );

    allCompositions.forEach((composition, index) => {
      if (index === this.currentIndex) {
        composition.classList.add("_active");
      } else {
        composition.classList.remove("_active");
      }
    });
  }

  bindEvents() {
    this.prevButton.addEventListener("click", () => this.prevSong());
    this.nextButton.addEventListener("click", () => this.nextSong());
    this.timerButton.addEventListener("click", () => {
      this.togglePlay();
    });

    this.audio.addEventListener("timeupdate", () => this.updateProgress());
    this.audio.addEventListener("ended", () => this.nextSong(true));
    this.audio.addEventListener("loadedmetadata", () => {
      this.updateCompositionTimeDisplay(this.currentIndex, this.audio.duration);
    });
  }

  updateCompositionTimeDisplay(index, duration) {
    if (!duration) return;
    const minutes = Math.floor(duration / 60);
    const seconds = Math.floor(duration % 60);
    const durationTimeStr = `${minutes}:${
      seconds < 10 ? "0" + seconds : seconds
    }`;
    const compositionTimeElement = this.container.querySelector(
      `.examples__player-composition-time[data-index="${index}"]`
    );
    if (compositionTimeElement) {
      compositionTimeElement.textContent = durationTimeStr;
    }
  }

  loadSong(index, autoplay = false) {
    const song = songsData[index];
    if (!song) return;

    this.playerPreviewImg.src = song.image;
    this.playerTitle.textContent = song.title;
    this.playerName.textContent = song.name;
    this.contentTitle.textContent = song.name;
    this.contentImg.src = song.image;
    this.contentDate.textContent = song.date;

    const decorateElement = this.container.querySelector(
      ".examples__body-decorate"
    );
    if (decorateElement && song.color) {
      decorateElement.style.background = song.color;
    }

    this.currentSongText = song.text;
    this.updateStoryText(song.text);

    this.audio.src = song.audio;
    this.audio.load();

    if (autoplay) {
      this.audio.play();
      this.isPlaying = true;
    } else {
      this.isPlaying = false;
    }

    this.updateUIState();
    this.updateActiveComposition();
  }

  async loadAllDurations() {
    for (let i = 0; i < songsData.length; i++) {
      const song = songsData[i];
      const audio = new Audio();
      await new Promise((resolve) => {
        audio.onloadedmetadata = () => {
          song.duration = audio.duration;
          this.updateCompositionTimeDisplay(i, audio.duration);
          resolve();
        };
        audio.onerror = () => {
          this.updateCompositionTimeDisplay(i, 0);
          resolve();
        };
        audio.src = song.audio;
        audio.load();
      });
    }
  }

  updateStoryText(text) {
    const maxLength = 400;
    if (text.length > maxLength) {
      this.contentText.textContent = text.substring(0, maxLength) + "...";
      this.contentMoreButton.classList.add("_show");

      if (window.innerWidth < 1280) {
        this.contentText.classList.remove("_show");
        this.contentMoreButton.textContent = "–ß–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª–Ω–æ—Å—Ç—å—é";
        this.isFullTextVisible = false;
        this.fullText = text;

        this.contentMoreButton.onclick = () => {
          if (!this.isFullTextVisible) {
            this.contentText.textContent = this.fullText;
            this.contentText.classList.add("_show");
            this.contentMoreButton.textContent = "–°–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é";
            this.isFullTextVisible = true;
          } else {
            this.contentText.classList.remove("_show");
            this.contentMoreButton.textContent = "–ß–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª–Ω–æ—Å—Ç—å—é";
            this.isFullTextVisible = false;
          }
        };
      } else {
        this.contentText.classList.add("_show");
        this.contentMoreButton.textContent = "–ß–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª–Ω–æ—Å—Ç—å—é";
        this.isFullTextVisible = false;
        this.fullText = text;

        this.contentMoreButton.onclick = () => {
          if (!this.isFullTextVisible) {
            this.contentText.textContent = this.fullText;
            this.contentMoreButton.textContent = "–°–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é";
            this.isFullTextVisible = true;
          } else {
            this.contentText.textContent = text.substring(0, maxLength) + "...";
            this.contentMoreButton.textContent = "–ß–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª–Ω–æ—Å—Ç—å—é";
            this.isFullTextVisible = false;
          }
        };
      }
    } else {
      this.contentText.textContent = text;
      this.contentMoreButton.classList.remove("_show");
      this.contentText.classList.add("_show");
      this.contentMoreButton.onclick = null;

      if (window.innerWidth < 1280) {
        this.contentText.classList.remove("_show");
        this.contentMoreButton.classList.add("_show");
        this.contentMoreButton.textContent = "–ß–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª–Ω–æ—Å—Ç—å—é";
        this.isFullTextVisible = false;
        this.fullText = text;

        this.contentMoreButton.onclick = () => {
          if (!this.isFullTextVisible) {
            this.contentText.textContent = this.fullText;
            this.contentText.classList.add("_show");
            this.contentMoreButton.textContent = "–°–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é";
            this.isFullTextVisible = true;
          } else {
            this.contentText.classList.remove("_show");
            this.contentMoreButton.textContent = "–ß–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª–Ω–æ—Å—Ç—å—é";
            this.isFullTextVisible = false;
          }
        };
      }
    }
  }

  updateUIState() {
    const allButtons = this.container.querySelectorAll(
      ".examples__player-composition-inner"
    );

    allButtons.forEach((button) => {
      const index = parseInt(button.getAttribute("data-index"), 10);
      const icons = button.querySelectorAll(
        ".examples__player-composition-cover-button-icon"
      );
      const playIcon = icons[0];
      const pauseIcon = icons[1];

      playIcon.classList.add("_show");
      pauseIcon.classList.remove("_show");

      if (index === this.currentIndex && this.isPlaying) {
        playIcon.classList.remove("_show");
        pauseIcon.classList.add("_show");
      }
    });

    if (this.isPlaying) {
      this.timerPlayIcon.classList.remove("_show");
      this.timerPauseIcon.classList.add("_show");
    } else {
      this.timerPlayIcon.classList.add("_show");
      this.timerPauseIcon.classList.remove("_show");
    }
  }

  togglePlay() {
    if (this.audio.paused) {
      this.audio.play();
      this.isPlaying = true;
    } else {
      this.audio.pause();
      this.isPlaying = false;
    }
    this.updateUIState();
  }

  prevSong(fromEnded = false) {
    this.currentIndex =
      (this.currentIndex - 1 + songsData.length) % songsData.length;
    const shouldAutoplay = this.isPlaying || fromEnded;
    this.loadSong(this.currentIndex, shouldAutoplay);
  }

  nextSong(fromEnded = false) {
    this.currentIndex = (this.currentIndex + 1) % songsData.length;
    const shouldAutoplay = this.isPlaying || fromEnded;
    this.loadSong(this.currentIndex, shouldAutoplay);
  }

  updateProgress() {
    const percent = (this.audio.currentTime / this.audio.duration) * 100;
    this.progressBar.style.width = `${percent || 0}%`;
  }

  handleResize() {
    if (this.currentSongText) {
      this.updateStoryText(this.currentSongText);
    }
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const playerContainer = document.querySelector(".examples");
  if (playerContainer) {
    new AudioPlayer(".examples");
  }
});
